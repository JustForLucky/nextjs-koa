{"ast":null,"code":"const axios = require('axios');\n\nconst isServer = true;\nconst github_base_url = 'https://api.github.com';\n\nasync function requestGithub(method, url, data, headers = {}) {\n  return await axios({\n    method,\n    url: `${github_base_url}/${url}`,\n    data,\n    headers\n  });\n}\n\nasync function request({\n  method = 'GET',\n  url,\n  data = {}\n}, req, res) {\n  if (!url) {\n    throw new Error('url must provide');\n  }\n\n  if (isServer) {\n    const headers = {};\n    const session = req.session;\n    const githubAuth = session.githubAuth || {};\n\n    if (githubAuth.access_token) {\n      headers['Authorization'] = `${githubAuth.token_type} ${githubAuth.access_token}`;\n    }\n\n    return await requestGithub(method, url, data, headers);\n  }\n\n  return await axios({\n    method,\n    url: `/github${url}`,\n    data\n  });\n}\n\nmodule.exports = {\n  request,\n  requestGithub\n};","map":{"version":3,"sources":["/Users/lili/projects/nextjs-koa/lib/api.js"],"names":["axios","require","isServer","github_base_url","requestGithub","method","url","data","headers","request","req","res","Error","session","githubAuth","access_token","token_type","module","exports"],"mappings":"AAAA,MAAMA,KAAK,GAAGC,OAAO,CAAC,OAAD,CAArB;;AAEA,MAAMC,QAAQ,OAAd;AAEA,MAAMC,eAAe,GAAG,wBAAxB;;AAEA,eAAeC,aAAf,CAA6BC,MAA7B,EAAqCC,GAArC,EAA0CC,IAA1C,EAAgDC,OAAO,GAAG,EAA1D,EAA8D;AAC1D,SAAO,MAAMR,KAAK,CAAC;AACfK,IAAAA,MADe;AAEfC,IAAAA,GAAG,EAAG,GAAEH,eAAgB,IAAGG,GAAI,EAFhB;AAGfC,IAAAA,IAHe;AAIfC,IAAAA;AAJe,GAAD,CAAlB;AAMH;;AAED,eAAeC,OAAf,CAAuB;AAAEJ,EAAAA,MAAM,GAAG,KAAX;AAAkBC,EAAAA,GAAlB;AAAuBC,EAAAA,IAAI,GAAE;AAA7B,CAAvB,EAA0DG,GAA1D,EAA+DC,GAA/D,EAAoE;AAChE,MAAI,CAACL,GAAL,EAAU;AACN,UAAM,IAAIM,KAAJ,CAAU,kBAAV,CAAN;AACH;;AACD,MAAIV,QAAJ,EAAc;AACV,UAAMM,OAAO,GAAG,EAAhB;AACA,UAAMK,OAAO,GAAGH,GAAG,CAACG,OAApB;AACA,UAAMC,UAAU,GAAGD,OAAO,CAACC,UAAR,IAAsB,EAAzC;;AACA,QAAIA,UAAU,CAACC,YAAf,EAA6B;AACzBP,MAAAA,OAAO,CAAC,eAAD,CAAP,GAA4B,GAAEM,UAAU,CAACE,UAAW,IAAGF,UAAU,CAACC,YAAa,EAA/E;AACH;;AACD,WAAO,MAAMX,aAAa,CAACC,MAAD,EAASC,GAAT,EAAcC,IAAd,EAAoBC,OAApB,CAA1B;AACH;;AACD,SAAO,MAAMR,KAAK,CAAC;AACfK,IAAAA,MADe;AAEfC,IAAAA,GAAG,EAAG,UAASA,GAAI,EAFJ;AAGfC,IAAAA;AAHe,GAAD,CAAlB;AAKH;;AAEDU,MAAM,CAACC,OAAP,GAAiB;AACbT,EAAAA,OADa;AAEbL,EAAAA;AAFa,CAAjB","sourcesContent":["const axios = require('axios')\n\nconst isServer = typeof window === 'undefined'\n\nconst github_base_url = 'https://api.github.com'\n\nasync function requestGithub(method, url, data, headers = {}) {\n    return await axios({\n        method,\n        url: `${github_base_url}/${url}`,\n        data,\n        headers\n    })\n}\n\nasync function request({ method = 'GET', url, data ={} }, req, res) {\n    if (!url) {\n        throw new Error('url must provide')\n    }\n    if (isServer) {\n        const headers = {}\n        const session = req.session\n        const githubAuth = session.githubAuth || {}\n        if (githubAuth.access_token) {\n            headers['Authorization'] = `${githubAuth.token_type} ${githubAuth.access_token}`\n        }\n        return await requestGithub(method, url, data, headers)\n    }\n    return await axios({\n        method,\n        url: `/github${url}`,\n        data\n    })\n}\n\nmodule.exports = {\n    request,\n    requestGithub\n}"]},"metadata":{},"sourceType":"script"}